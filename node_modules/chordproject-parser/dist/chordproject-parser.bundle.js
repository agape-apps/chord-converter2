!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ChordProjectParser=e():t.ChordProjectParser=e()}(self,(function(){return(()=>{"use strict";var t,e,s,a,r,i,n,o={d:(t,e)=>{for(var s in e)o.o(e,s)&&!o.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},l={};o.r(l),o.d(l,{Chord:()=>T,ChordDiagram:()=>R,ChordLyricsPair:()=>C,ChordProFormatter:()=>W,ChordProParser:()=>w,FormatterSettings:()=>P,HtmlFormatter:()=>U,Key:()=>_,MusicAccidental:()=>s,MusicLetter:()=>e,MusicNote:()=>g,ParserWarning:()=>O,Song:()=>v,TextFormatter:()=>j,TimeSignature:()=>M,Transposer:()=>k}),function(t){t.Lyrics="lyrics",t.Comment="comment",t.Empty="empty",t.Custom="custom",t.Tabs="tabs",t.Unknown="unknown"}(t||(t={}));class h{constructor(e){this._lineType=t.Unknown,this._lineType=e}get lineType(){return this._lineType}}class u extends h{constructor(e){super(t.Comment),this._comment=e}clone(){return new u(this._comment)}get comment(){return this._comment}}class c extends h{clone(){return new c}constructor(){super(t.Empty)}}class d extends h{constructor(e=[]){super(t.Lyrics),this._pairs=[],this._pairs=e}clone(){let t=[];return this._pairs.forEach((e=>{t.push(e.clone())})),new d(t)}get pairs(){return this._pairs}addPair(t){this._pairs.push(t)}}class m extends h{constructor(e){super(t.Tabs),this._value=e}clone(){return new m(this.value)}get value(){return this._value}}class p extends h{constructor(e,s){super(t.Custom),this._name=e,this._value=s}clone(){return new p(this.name,this.value)}get name(){return this._name}get value(){return this._value}}class g{constructor(t,e=s.none){this.letter=t,this.accidental=e}toString(){return this.accidental===s.none?e[this.letter]:e[this.letter]+s[this.accidental]}clone(){return new g(this.letter,this.accidental)}static parse(t){if(!t)return;const a=t.trim().match(/^(?<letter>[A-G])(?<symbol>(#{1,2}|b{1,2}|x))?$/);if(!a||!a.groups)return;const r=a.groups.letter,i=e[r];if(null==i)return;let n=a.groups.symbol;"x"==n&&(n="##");const o=s[n];return new g(i,o)}equals(t){return!!t&&t.toString()===this.toString()}}!function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.C=2]="C",t[t.D=3]="D",t[t.E=4]="E",t[t.F=5]="F",t[t.G=6]="G"}(e||(e={})),function(t){t[t.b=0]="b",t[t.bb=1]="bb",t[t["#"]=2]="#",t[t["##"]=3]="##",t[t.none=4]="none"}(s||(s={}));class _{constructor(t,e=a.Major){this.note=t,this.mode=e}clone(){return new _(this.note.clone(),this.mode)}static parse(t){if(!t)return;const e=t.trim().match(/^(?<note>[A-G](#{1,2}|b{1,2}|x)?)(?<mode>m?)$/);if(!e||!e.groups)return;const s=g.parse(e.groups.note);if(null==s)return;const r="m"===e.groups.mode?a.Minor:a.Major;return new _(s,r)}toString(){return this.note.toString()+(this.mode==a.Major?"":"m")}equals(t){return this.toString()==t.toString()}}!function(t){t[t.Major=0]="Major",t[t.Minor=1]="Minor"}(a||(a={}));class T{constructor(t,e="",s=null){this.key=t,this.type=e,this.bass=s}clone(){var t;return new T(this.key.clone(),this.type,null===(t=this.bass)||void 0===t?void 0:t.clone())}static parse(t){if(!t)return;const e=(t=t.trim()).match(T.chordRegex);if(!e||!e.groups)return;const s=e.groups.note,a=_.parse(s);if(null==a)return;const r=e.groups.type,i=e.groups.bass,n=g.parse(i);return new T(a,r,n)}toString(t=!0,e=!0){var s=this.key.toString();return t&&(s+=this.type),e&&this.bass&&(s+="/"+this.bass.toString()),s}toSimpleString(){return this.toString(!1,!1)}equals(t){return!!t&&t.toString()===this.toString()}}T.chordRegex=/^(?<note>[A-G](#{1,2}|b{1,2}|x)?(min|m(?!aj)|-)?)(?<type>(?!\/).*?)?(?:$|(?:\/(?<bass>[A-G](#{1,2}|b{1,2}|x)?)))$/,function(t){t.Lyrics="lyrics",t.Tabs="tabs",t.None="none"}(r||(r={}));class f{constructor(t){this._sectionType=r.None,this._lines=[],this._sectionType=t}get lines(){return this._lines}get sectionType(){return this._sectionType}}!function(t){t.Chorus="chorus",t.Verse="verse",t.Bridge="bridge",t.Custom="custom",t.None="none"}(i||(i={}));class E extends f{constructor(t){super(r.Lyrics),this._type=t}get type(){return this._type}addLine(t){this._lines.push(t)}}class b extends E{constructor(t,e,s=null){super(t),this._name=e,this._value=s}clone(){let t=new b(this.type,this._name,this._value);return this._lines.forEach((e=>{t.addLine(e.clone())})),t}get name(){return this._name}get value(){return this._value}}class S extends E{clone(){let t=new S;return this._lines.forEach((e=>{t.addLine(e.clone())})),t}constructor(){super(i.None)}}class y extends f{constructor(t=null){super(r.Tabs),this._value=null,this._value=t}clone(){let t=new y(this._value);return this._lines.forEach((e=>{t.addLine(e.clone())})),t}get value(){return this._value}addLine(t){this.lines.push(t)}}class M{constructor(t,e){this.topNumber=t,this.bottomNumber=e}toString(){return`${this.topNumber.toString()}/${this.bottomNumber.toString()}`}}class v{constructor(){this.title=null,this.subtitle=null,this.albums=[],this.artists=[],this.composers=[],this.arrangers=[],this.lyricists=[],this.year=null,this.copyright=null,this.key=null,this.capo=0,this.duration=null,this.time=null,this.tempo=null,this.customMetadatas=[],this.userDiagrams=[],this.rawContent="",this.sections=[]}getLyrics(){let t=[];return this.sections.forEach((e=>{e instanceof E&&e.lines.forEach((e=>{let s="";e instanceof d&&e.pairs.forEach((t=>{t.lyrics&&(s+=t.lyrics)})),s=s.trim(),s&&t.push(s)}))})),t}getAllChords(){let t=[];return this.sections.forEach((e=>{e instanceof E&&e.lines.forEach((e=>{e instanceof d&&e.pairs.forEach((e=>{if(e.hasChord()){const s=e.chord;t.push(s)}}))}))})),t}getUniqueChords(){const t=this.getAllChords();let e=[];return t.forEach((t=>{e.find((e=>e.equals(t)))||e.push(t)})),e}getPossibleKey(){const t=this.getAllChords();if(0==t.length)return;const e=t[0].key,s=t[t.length-1].key;if(e.equals(s))return e.clone();let a=[];t.forEach((t=>{let e=a.find((e=>e.key.equals(t.key)));e?e.count++:a.push({count:0,key:t.key.clone()})})),a.sort(((t,e)=>e.count-t.count));let r=a[0],i=a.find((t=>t.key.equals(e))).count,n=a.find((t=>t.key.equals(s))).count;return r.count>i&&r.count>n?r.key.clone():i>n?e.clone():s.clone()}clone(){let t=new v;return t.albums=this.albums,t.arrangers=this.arrangers,t.artists=this.artists,t.capo=this.capo,t.composers=this.composers,t.copyright=this.copyright,t.customMetadatas=this.customMetadatas,t.duration=this.duration,t.lyricists=this.lyricists,t.rawContent=this.rawContent,t.subtitle=this.subtitle,t.tempo=this.tempo,t.title=this.title,t.year=this.year,this.time&&(t.time=new M(this.time.bottomNumber,this.time.topNumber)),this.key&&(t.key=this.key.clone()),this.userDiagrams.forEach((e=>{t.userDiagrams.push(e.clone())})),this.sections.forEach((e=>{t.sections.push(e.clone())})),t}}class R{constructor(t,e,s=[],a=1){this._chord=t,this._frets=e,this._fingers=s,this._variation=a}get chord(){return this._chord}get frets(){return this._frets}get fingers(){return this._fingers}get variation(){return this._variation}clone(){return new R(this._chord.clone(),[...this._frets],[...this._fingers],this.variation)}static parse(t){var e,s;const a=t.match(/^\{define: (?<chord>([A-G][#bx]{0,2})(.*?)(?: |(?:\/([A-G][#bx]{0,2})))) *base-fret (?<basefret>[1-9][0-9]?) *frets(?<frets>( [0-9xNn]){6})( *fingers(?<fingers>( [0-5]){6}))?\}$/);if(!a||a.length<1||!a.groups)return;const r=a.groups.chord,i=parseInt(a.groups.basefret,10),n=null===(e=a.groups.fingers)||void 0===e?void 0:e.trim().split(" ").map(Number),o=null===(s=a.groups.frets)||void 0===s?void 0:s.trim().split(" "),l=[];o.forEach((t=>{const e=parseInt(t,10);let s=isNaN(e)?-1:e;i>1&&s>0&&(s+=i-1),l.push(s)}));const h=T.parse(r);return h&&l&&!isNaN(i)?new R(h,l,n):void 0}hasBarre(){return this.barre()>0}barre(){const t=this.frets.filter((t=>0!=t)),e=this.fingers.filter((t=>1===t));return t.length<this.frets.length||e.length<=1?0:this.fretsRange()[0]}fretsRange(t=!0){const e=t?-1:0,s=this._frets.filter((t=>t>e));return[Math.min(...s),Math.max(...s)]}getRelativeFrets(){let t=this.fretsRange(!1),e=t[0],s=t[1];(e<1||s<4)&&(e=1);const a=-(e-1);return[e,this.tryMovingFrets(a)[1]]}tryMovingFrets(t){return 0===t?[!0,this._frets]:t>this.fretsRange()[0]?[!1,this._frets]:[!0,this._frets.map((e=>e<1?e:e+t))]}}class C{constructor(t,e=null,s=null){this.lyrics=t,this.chord=e,this.text=s}clone(){var t;return new C(this.lyrics,null===(t=this.chord)||void 0===t?void 0:t.clone(),this.text)}hasChord(){return null!==this.chord}hasText(){return null!==this.text}static parse(t){const e=t.match(/\[(?<value>.*?)\]/);if(!e||!e.groups)return[!0,new C(t)];const s=e.groups.value,a=t.substring(s.length+2,t.length);return this.createChordLyricsPair(a,s)}static parseLine(t){const e=[],s=/\[(?<value>.*?)\]/g;if(!s.test(t))return e.push([!0,new C(t)]),e;let a;s.lastIndex=0;let r=0,i=null;for(;a=s.exec(t);){const n=t.substring(r,a.index);n&&e.push(this.createChordLyricsPair(n,i)),i=a.groups.value,r=s.lastIndex}const n=t.substring(r,t.length);return n&&e.push(this.createChordLyricsPair(n,i)),e}static createChordLyricsPair(t,e){let s=null,a=null;(null==e?void 0:e.startsWith("*"))?a=e.substring(1,e.length):s=e?T.parse(e):null;const r=new C(t,s,a),i=void 0!==s;return i||(r.text=e),[i,r]}}class O{constructor(t,e){this._message=t,this._lineNumber=e}toString(){return`Warning: ${this._message} on line ${this._lineNumber}`}}class N{}N.ALBUM="album",N.ARRANGER="arranger",N.ARTIST="artist",N.CAPO="capo",N.COMMENT="comment",N.DEFINE="define",N.COMPOSER="composer",N.COPYRIGHT="copyright",N.DURATION="duration",N.END_OF_BRIDGE="end_of_bridge",N.END_OF_CHORUS="end_of_chorus",N.END_OF_TAB="end_of_tab",N.END_OF_VERSE="end_of_verse",N.KEY="key",N.LYRICIST="lyricist",N.START_OF_BRIDGE="start_of_bridge",N.START_OF_CHORUS="start_of_chorus",N.START_OF_TAB="start_of_tab",N.START_OF_VERSE="start_of_verse",N.SUBTITLE="subtitle",N.TEMPO="tempo",N.TIME="time",N.TITLE="title",N.YEAR="year",N.TITLE_SHORT="t",N.SUBTITLE_SHORT="st",N.COMMENT_SHORT="c",N.START_OF_CHORUS_SHORT="soc",N.END_OF_CHORUS_SHORT="eoc",N.START_OF_VERSE_SHORT="sov",N.END_OF_VERSE_SHORT="eov",N.START_OF_BRIDGE_SHORT="sob",N.END_OF_BRIDGE_SHORT="eob",N.START_OF_TAB_SHORT="sot",N.END_OF_TAB_SHORT="eot",N.META_TAGS=[N.ALBUM,N.ARRANGER,N.ARTIST,N.CAPO,N.COMPOSER,N.COPYRIGHT,N.DURATION,N.KEY,N.LYRICIST,N.TEMPO,N.TIME,N.TITLE,N.SUBTITLE,N.YEAR],N.START_BLOCK_TAGS=[N.START_OF_BRIDGE,N.START_OF_CHORUS,N.START_OF_TAB,N.START_OF_VERSE],N.END_BLOCK_TAGS=[N.END_OF_BRIDGE,N.END_OF_CHORUS,N.END_OF_TAB,N.END_OF_VERSE],function(t){t[t.Metadata=0]="Metadata",t[t.CustomMetadata=1]="CustomMetadata",t[t.StartOfBlock=2]="StartOfBlock",t[t.EndOfBlock=3]="EndOfBlock",t[t.Comment=4]="Comment",t[t.Define=5]="Define",t[t.Custom=6]="Custom",t[t.None=7]="None"}(n||(n={}));class A{constructor(){this._originalName="",this._value=null,this._type=n.None}get value(){return this._value}get type(){return this._type}get shortName(){return A.getShortName(this._originalName)}get longName(){return A.getLongName(this._originalName)}static getLongName(t){if(!t)return t;const e=this.ALIASES.find((e=>e.shortName===t));return e?e.longName:t}static getShortName(t){if(!t)return t;const e=this.ALIASES.find((e=>e.longName===t));return e?e.shortName:t}static parse(t){const e=t.trim();if(this.CUSTOM_META_TAG_REGEX.test(e)){let t=this.parseRegex(e,this.CUSTOM_META_TAG_REGEX);return t&&(t._type=n.Custom),t}if(this.META_TAG_REGEX.test(e)){let t=this.parseRegex(e,this.META_TAG_REGEX);return t&&(t._type=N.META_TAGS.find((e=>e===t.longName))?t._type=n.Metadata:t._type=n.CustomMetadata),t}if(this.TAG_REGEX.test(e)){let t=this.parseRegex(e,this.TAG_REGEX);if(t){if(N.META_TAGS.find((e=>e===t.longName)))t._type=n.Metadata;else if(t.longName.startsWith("start_of_"))t._type=n.StartOfBlock;else if(t.longName.startsWith("end_of_"))t._type=n.EndOfBlock;else if(t.longName===N.DEFINE)t._type=n.Define;else{if(t.longName!==N.COMMENT)return;t._type=n.Comment}return t}}}static parseRegex(t,e){let s=new A;const a=t.trim().match(e);if(a&&a.groups){if(!a.groups.name)return;return s._originalName=a.groups.name,a.groups.value&&(s._value=a.groups.value),s}}}A.ALIASES=[{shortName:N.TITLE_SHORT,longName:N.TITLE},{shortName:N.SUBTITLE_SHORT,longName:N.SUBTITLE},{shortName:N.COMMENT_SHORT,longName:N.COMMENT},{shortName:N.START_OF_BRIDGE_SHORT,longName:N.START_OF_BRIDGE},{shortName:N.END_OF_BRIDGE_SHORT,longName:N.END_OF_BRIDGE},{shortName:N.START_OF_CHORUS_SHORT,longName:N.START_OF_CHORUS},{shortName:N.END_OF_CHORUS_SHORT,longName:N.END_OF_CHORUS},{shortName:N.START_OF_VERSE_SHORT,longName:N.START_OF_VERSE},{shortName:N.END_OF_VERSE_SHORT,longName:N.END_OF_VERSE},{shortName:N.START_OF_TAB_SHORT,longName:N.START_OF_TAB},{shortName:N.END_OF_TAB_SHORT,longName:N.END_OF_TAB}],A.META_TAG_REGEX=/^meta:\s*(?<name>[^:\s]+)(\s*(?<value>.+))?$/,A.TAG_REGEX=/^(?<name>[^:\s]+)(:?\s*(?<value>.+))?$/,A.CUSTOM_META_TAG_REGEX=/^(?<name>x_[^:]+)(:?\s*(?<value>.+))?$/;class w{constructor(){this._currentLineIndex=0,this.TAG_REGEX=/\{(?<value>.*)\}/,this.TAB_LINE_REGEX=/^[aA-zZ]\|[^ ]+$/,this.CHORD_REGEX=/\[(.*?)\]/g,this.SPLIT_CHORD_REGEX=/(?=\[.*?\])/g,this._song=new v,this._currentSection=new S,this._currentSectionTagName=null,this._warnings=[]}get warnings(){return this._warnings}parse(t){if(!t.trim())return this.addWarning("The song sheet is empty"),new v;this._song.rawContent=t;const e=t.split(/\r\n|\r|\n/);for(;!e[0].trim();)e.splice(0,1);return e.forEach((t=>{this.parseLine(t),this._currentLineIndex++})),this.completeCurrentSection(),this._song.key,this._song}parseLine(t){if(t=t.trim())if(this.TAG_REGEX.test(t))this.parseTag(t);else switch(this._currentSection.sectionType){case r.Tabs:this.parseTabLine(t);break;case r.Lyrics:this.parseLyricsLine(t)}else this.addLine(new c)}parseTabLine(t){this._currentSection instanceof y?(this.TAB_LINE_REGEX.test(t)||this.addWarning("This tabs line is invalid. It must starts with the string name and a pipe."),this.addLine(new m(t))):this.addWarning("Internal error: wrong section type")}parseLyricsLine(t){if(this._currentSection instanceof E){const e=t.replace(this.CHORD_REGEX,"");/[\[\]\{\}]/.test(e)&&this.addWarning("The lyrics line contains invalid characters or unclosed chords.");const s=t.split(this.SPLIT_CHORD_REGEX),a=[];s.forEach((t=>{const e=C.parse(t);e[0]||(e[1].lyrics.trim()?this.addWarning(`Cannot parse the chord '${e[1].text}' before the lyrics '${e[1].lyrics.trim()}'`):this.addWarning(`Cannot parse the chord '${e[1].text}'`)),a.push(e[1])}));const r=new d(a);this.addLine(r)}else this.addWarning("Internal error: wrong section type")}parseTag(t){const e=t.match(this.TAG_REGEX);if(!e||!e.groups||!e.groups.value)return void this.addWarning("Invalid tag.");const s=A.parse(e.groups.value.trim());if(s)switch(s.type){case n.Metadata:this.parseMetadataTag(s.longName,s.value);break;case n.Comment:this.parseCommentTag(s.value);break;case n.Define:this.parseDefineTag(s.value);break;case n.Custom:this.parseCustomTag(s.longName,s.value);break;case n.CustomMetadata:this.parseCustomMetadataTag(s.longName,s.value);case n.StartOfBlock:this.parseStartOfBlockTag(s.longName,s.value);break;case n.EndOfBlock:this.parseEndOfBlockTag(s.longName);break;default:this.addWarning("Unknown tag type.")}else this.addWarning("Unknown or mal-formatted tag.")}parseCommentTag(t){t?this.addLine(new u(t)):this.addWarning("The comment tag must have a value")}parseDefineTag(t){if(!t)return void this.addWarning("The define tag must have a value");const e=R.parse(t);e?this._song.userDiagrams.push(e):this.addWarning("The define tag is invalid")}parseCustomTag(t,e){this.addLine(new p(t,e))}parseStartOfBlockTag(t,e){null!==this._currentSectionTagName&&this.addWarning(`The section tag ${this._currentSectionTagName} must be closed before starting a new section`),this.completeCurrentSection();const s=t.replace("start_of_","");this._currentSectionTagName=s;const a=N.START_BLOCK_TAGS.find((e=>e===t));if(a)switch(a){case N.START_OF_BRIDGE:return void(this._currentSection=new b(i.Bridge,s,e));case N.START_OF_CHORUS:return void(this._currentSection=new b(i.Chorus,s,e));case N.START_OF_VERSE:return void(this._currentSection=new b(i.Verse,s,e));case N.START_OF_TAB:return void(this._currentSection=new y(e))}else this._currentSection=new b(i.Custom,s,e)}parseEndOfBlockTag(t){this._currentSectionTagName?(t.replace("end_of_","")!==this._currentSectionTagName&&this.addWarning("The end of section tag does not match the start of section tag."),this.completeCurrentSection()):this.addWarning("This end of section tag is useless and will be ignore.")}completeCurrentSection(){this._currentSection.lines.length>0&&this._song.sections.push(this._currentSection),this._currentSection=new S,this._currentSectionTagName=null}addLine(t){this._currentSection.sectionType!==r.Tabs||t instanceof m?this._currentSection.addLine(t):this.addWarning("Tabs section can only contains tabs lines")}parseMetadataTag(t,e){if(e&&e.trim())switch(t){case N.ALBUM:this._song.albums.push(e);break;case N.ARRANGER:this._song.arrangers.push(e);break;case N.ARTIST:this._song.artists.push(e);break;case N.CAPO:this.parseCapoMetadata(e);break;case N.COMPOSER:this._song.composers.push(e);break;case N.COPYRIGHT:this._song.copyright=e;break;case N.DURATION:this.parseDurationMetadata(e);break;case N.KEY:this.parseKeyMetadata(e);break;case N.LYRICIST:this._song.lyricists.push(e);break;case N.TEMPO:this.parseTempoMetadata(e);break;case N.TIME:this.parseTimeMetadata(e);break;case N.TITLE:this._song.title=e;break;case N.SUBTITLE:this._song.subtitle=e;break;case N.YEAR:this.parseYearMetadata(e);break;default:this.addWarning("Unknown metadata tag")}else this.addWarning("The metadata must have a value")}parseYearMetadata(t){const e=parseInt(t,10);isNaN(e)||4!=e.toString().length?this.addWarning("The year metadata must be a 4 digits number"):this._song.year=e}parseCapoMetadata(t){const e=parseInt(t,10);isNaN(e)?this.addWarning("The capo metadata must be a number"):this._song.capo=e}parseDurationMetadata(t){const e=t.match(/^((?<time>[0-9]+)|(?<minutes>[0-5]?[0-9]):(?<seconds>[0-5][0-9]))$/);if(!e||!e.groups)return void this.addWarning("The duration metadata is invalid. Must be a number or a time (eg: 5:30)");if(e.groups.time){const e=parseInt(t,10);this._song.duration=e}const s=e.groups.minutes,a=e.groups.seconds;s&&a?this._song.duration=60*parseInt(s,10)+parseInt(a):this.addWarning("The duration metadata time format is invalid")}parseTempoMetadata(t){const e=parseInt(t,10);isNaN(e)?this.addWarning("The tempo metadata must be a number"):this._song.tempo=e}parseKeyMetadata(t){const e=_.parse(t);e?this._song.key=e:this.addWarning("The key metadata is not a valid key")}parseTimeMetadata(t){const e=t.match(/^(?<top>[0-9]{1,2})\/(?<bottom>[0-9]{1,2})$/);if(!(e&&e.groups&&e.groups.top&&e.groups.bottom))return void this.addWarning("The time metadata is invalid. Must be number/number (eg: 6/8)");const s=parseInt(e.groups.top),a=parseInt(e.groups.bottom);this._song.time=new M(s,a)}parseCustomMetadataTag(t,e){this._song.customMetadatas.push([t,e])}addWarning(t){const e=new O(t,this._currentLineIndex+1);this._warnings.push(e)}}class L{static semiTonesBetween(t,e){if(t.equals(e))return 0;const s=this.notes.find((e=>e.letter==t.letter)).value,a=this.notes.find((t=>t.letter==e.letter)).value,r=this.accidentals.find((e=>e.accidental==t.accidental)).value,i=a+this.accidentals.find((t=>t.accidental==e.accidental)).value-(s+r);return this.positiveMod(i,12)}static letterDiff(t,e){if(t==e)return 0;const s=this.notes.find((e=>e.letter==t)).index,a=this.notes.find((t=>t.letter==e)).index;return this.positiveMod(a-s,7)}static transpose(t,e,s){if(0==e&&0==s)return t;e=this.positiveMod(e,7),s=this.positiveMod(s,12);let a=(this.notes.find((e=>e.letter==t.letter)).index+e)%7,r=this.notes[a],i=this.semiTonesBetween(t,new g(r.letter)),n=s-i;Math.abs(n)>2&&(a=n<0?this.positiveMod(--a,7):this.positiveMod(++a,7),r=this.notes[a],i=this.semiTonesBetween(t,new g(r.letter)),n=s-i);const o=this.accidentals.find((t=>t.value==n)).accidental;return new g(r.letter,o)}static positiveMod(t,e){return(t%e+e)%e}}L.notes=[{letter:e.A,index:0,value:0},{letter:e.B,index:1,value:2},{letter:e.C,index:2,value:3},{letter:e.D,index:3,value:5},{letter:e.E,index:4,value:7},{letter:e.F,index:5,value:8},{letter:e.G,index:6,value:10}],L.accidentals=[{accidental:s.none,value:0},{accidental:s["#"],value:1},{accidental:s["##"],value:2},{accidental:s.b,value:-1},{accidental:s.bb,value:-2}];class k{static transpose(t,e){let s=t.clone(),a=s.key?s.key:s.getPossibleKey();if(!a)return t;const i=L.letterDiff(a.note.letter,e.letter),n=L.semiTonesBetween(a.note,e);return a.note=e,s.sections.forEach(((t,e)=>{t.sectionType==r.Lyrics&&t.lines.forEach(((t,a)=>{t instanceof d&&t.pairs.forEach(((t,r)=>{if(t.chord){const o=L.transpose(t.chord.key.note,i,n),l=t.chord;if(l.key.note=o,t.chord.bass){const e=L.transpose(t.chord.bass,i,n);l.bass=e}s.sections[e].lines[a].pairs[r].chord=l}}))}))})),s}}class I{static toMinutesSeconds(t){const e=Math.floor(t/60),s=t-60*e;return`${e.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}:${s.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}`}static toProperCase(t){return t.length<1?t:t.charAt(0).toUpperCase()+t.substring(1).toLocaleLowerCase()}}class x{constructor(){this.useSimpleChord=!1,this.showChords=!0}}class H{constructor(t=new x){this.settings=t}writeMetadata(t,e){return e?`${I.toProperCase(t)}: ${e}`:I.toProperCase(t)}buildMetadataArray(t,e,s){const a=t.length>1?s:e,r=t.join(", ");return`${I.toProperCase(a)}: ${r}`}titleMetadata(t){return[t]}subtitleMetadata(t){return[t]}artistsMetadata(t){return[t.join(", ")]}composersMetadata(t){return[this.buildMetadataArray(t,"Composer","Composers")]}lyricistsMetadata(t){return[this.buildMetadataArray(t,"Lyricist","Lyricists")]}arrangersMetadata(t){return[this.buildMetadataArray(t,"Arranger","Arrangers")]}yearMetadata(t){return[this.writeMetadata("Year",t.toString())]}copyrightMetadata(t){return[this.writeMetadata("Copyright",t)]}timeMetadata(t){return[this.writeMetadata("Time",t)]}tempoMetadata(t){return[this.writeMetadata("Tempo",t.toString())]}durationMetadata(t){return[this.writeMetadata("Duration",I.toMinutesSeconds(t))]}capoMetadata(t){return[this.writeMetadata("Capo",t.toString())]}keyMetadata(t){return[this.writeMetadata("Key",t)]}customMetadatas(t){let e=[];return t.forEach((t=>{e.push(this.writeMetadata(t[0],t[1]))})),e}emptyLine(){return[""]}lyricsLine(t){let e="",s="",a=[];return t.pairs.forEach((t=>{let a=1;if(this.settings.showChords)if(t.chord){let s=this.settings.useSimpleChord?t.chord.toSimpleString():t.chord.toString();e+=s,a=t.lyrics.length-s.length}else t.text?(e+=t.text,a=t.lyrics.length-t.text.length):a=t.lyrics.length;a>0?(e+=" ".repeat(a),s+=t.lyrics):(e+=" ",s+=t.lyrics+" ".repeat(Math.abs(a)+1))})),e=e.trimEnd(),s=s.trimEnd(),e&&a.push(e),s&&a.push(s),a}commentLine(t){return["#"+t.comment]}tabLine(t){return[t.value]}customLine(t){return[]}sectionStart(t){return(t instanceof b||t instanceof y)&&t.value?[t.value]:[]}sectionEnd(t){return[]}metadataStart(){return["*".repeat(10)]}metadataEnd(){return["*".repeat(10)]}contentStart(){return[]}contentEnd(){return[]}}class G{constructor(t=new x){this.settings=t}buildMetadata(t,e){return e?`{${t}: ${e}}`:`{${t}}`}buildMetadatas(t,e){let s=[];return e.forEach((e=>{s.push(this.buildMetadata(t,e))})),s}titleMetadata(t){return[this.buildMetadata("title",t)]}subtitleMetadata(t){return[this.buildMetadata("subtitle",t)]}artistsMetadata(t){return this.buildMetadatas("artist",t)}composersMetadata(t){return this.buildMetadatas("composer",t)}lyricistsMetadata(t){return this.buildMetadatas("lyricist",t)}arrangersMetadata(t){return this.buildMetadatas("arranger",t)}yearMetadata(t){return[this.buildMetadata("year",t.toString())]}copyrightMetadata(t){return[this.buildMetadata("copyright",t)]}timeMetadata(t){return[this.buildMetadata("time",t)]}tempoMetadata(t){return[this.buildMetadata("tempo",t.toString())]}durationMetadata(t){return[this.buildMetadata("duration",I.toMinutesSeconds(t))]}capoMetadata(t){return[this.buildMetadata("capo",t.toString())]}keyMetadata(t){return[this.buildMetadata("key",t)]}customMetadatas(t){let e=[];return t.forEach((t=>{e.push(this.buildMetadata(t[0].toLowerCase(),t[1]))})),e}emptyLine(){return[""]}lyricsLine(t){let e="";return t.pairs.forEach((t=>{if(this.settings.showChords)if(t.chord){let s=this.settings.useSimpleChord?t.chord.toSimpleString():t.chord.toString();e+=`[${s}]${t.lyrics}`}else t.text?e+=`[*${t.text}]${t.lyrics}`:e+=t.lyrics;else e+=t.lyrics})),[e.trim()]}commentLine(t){return[this.buildMetadata("comment",t.comment)]}tabLine(t){return[t.value]}customLine(t){return[this.buildMetadata(t.name,t.value)]}sectionStart(t){if(t instanceof b||t instanceof y){let e=t instanceof y?"tab":t.name;return[this.buildMetadata("start_of_"+e,t.value)]}return[]}sectionEnd(t){if(t instanceof b||t instanceof y){let e=t instanceof y?"tab":t.name;return[this.buildMetadata("end_of_"+e,null)]}return[]}metadataStart(){return[]}metadataEnd(){return[]}contentStart(){return[]}contentEnd(){return[]}}class D{constructor(t){this.value=t}toStringLines(){return[this.value]}}class B{constructor(t,e,...s){this.classNames=[],this.innerHtml=[],this.tag=t,this.innerHtml=s,this.classNames=e}toStringLines(){const t=[];return t.push(`<${this.tag} class="${this.classNames.join(" ")}">`),this.innerHtml.forEach((e=>{t.push(...e.toStringLines())})),t.push(`</${this.tag}>`),t}addElement(...t){this.innerHtml.push(...t)}addString(t){this.innerHtml.push(new D(t))}}class F{constructor(t=new x){this.settings=t}buildHtmlElement(t,e,s=[]){return`<${t} class="${s.join(" ")}">${e}</${t}>`}titleMetadata(t){return[this.buildHtmlElement("h1",t,["metadata","title-metadata"])]}subtitleMetadata(t){return[this.buildHtmlElement("h2",t,["metadata","subtitle-metadata"])]}artistsMetadata(t){return[this.buildHtmlElement("h3",t.join(", "),["metadata","artist-metadata"])]}composersMetadata(t){const e=t.length>1?"Composers":"Composer";return[this.buildHtmlElement("div",e+": "+t.join(", "),["metadata","composer-metadata"])]}lyricistsMetadata(t){const e=t.length>1?"Lyricists":"Lyricist";return[this.buildHtmlElement("div",e+": "+t.join(", "),["metadata","lyricist-metadata"])]}arrangersMetadata(t){const e=t.length>1?"Arrangers":"Arranger";return[this.buildHtmlElement("div",e+": "+t.join(", "),["metadata","arranger-metadata"])]}yearMetadata(t){return[this.buildHtmlElement("div","Year: "+t,["metadata","year-metadata"])]}copyrightMetadata(t){return[this.buildHtmlElement("div","Copyright: "+t,["metadata","copyright-metadata"])]}timeMetadata(t){return[this.buildHtmlElement("div","Time: "+t,["metadata","time-metadata"])]}tempoMetadata(t){return[this.buildHtmlElement("div","Tempo: "+t,["metadata","tempo-metadata"])]}durationMetadata(t){return[this.buildHtmlElement("div","Duration: "+I.toMinutesSeconds(t),["metadata","duration-metadata"])]}capoMetadata(t){return[this.buildHtmlElement("div","Capo: "+t,["metadata","capo-metadata"])]}keyMetadata(t){return[this.buildHtmlElement("div","Key: "+t,["metadata","key-metadata"])]}customMetadatas(t){let e=[];const s=["metadata","custom-metadata"];return t.forEach((t=>{e.push(this.buildHtmlElement("div",I.toProperCase(t[0])+": "+t[1],s))})),e}emptyLine(){return[this.buildHtmlElement("div","",["line","empty-line"])]}createWordElement(...t){return t.map((t=>t.toStringLines())).join("").trim()?new B("div",["word"],...t):new D("")}createChordElement(t,e){let s=["above-lyrics"];e?s.push("chord"):s.push("annotation");let a=new B("span",s);return a.addString(t),a}createLyricsElement(t){let e=new B("span",["lyrics"]);return e.addString(t),e}createChordLyricsElement(t,e,s){if(!this.settings.showChords&&"&nbsp;"==s)return new D("");let a=new B("div",["chord-lyrics"]);return this.settings.showChords&&a.addElement(this.createChordElement(t,e)),s&&a.addElement(this.createLyricsElement(s)),a}lyricsLine(t){let e=t.pairs.map((t=>t.lyrics)).join("").trim();if(!this.settings.showChords&&!e)return[];let s=new B("div",["lyrics-line"]),a=[];if(t.pairs.forEach(((r,i)=>{let n=null!=r.chord||null!=r.text,o=null!=r.chord,l="";r.chord?l=this.settings.useSimpleChord?r.chord.toSimpleString():r.chord.toString():r.text&&(l=r.text);let h=n?r.lyrics:r.lyrics.trimStart();h=h.replace(/ +/g," ");let u=h.split(" "),c=u.shift(),d=u.pop();if(""==c){if(a.length>0){let t=this.createWordElement(...a);s.addElement(t),a=[]}c="&nbsp;",u.length>0&&(c+=u.shift())}e||(c=void 0);var m=n?this.createChordLyricsElement(l,o,c):this.createLyricsElement(c);if(a.push(m),null==d&&i<t.pairs.length-1)return;let p=this.createWordElement(...a);s.addElement(p),a=[],u.forEach((t=>{let e=this.createLyricsElement(t),a=this.createWordElement(e);s.addElement(a)})),""!=d&&null!=d&&(a.push(this.createLyricsElement(d)),t.pairs.length)})),a.length>0){let t=this.createWordElement(...a);s.addElement(t),a=[]}return s.toStringLines()}commentLine(t){return[this.buildHtmlElement("div",t.comment,["line","comment-line"])]}tabLine(t){return[this.buildHtmlElement("div",t.value,["line","tab-line"])]}customLine(t){const e=["metadata","custom-metadata",t.name];return[this.buildHtmlElement("div",t.value?t.value:"",e)]}sectionStart(t){let e=[];if(t instanceof b||t instanceof y){let s="tab";if(t instanceof b)switch(t.type){case i.Chorus:s="chorus";break;case i.Verse:s="verse";break;case i.Bridge:s="bridge";break;case i.Custom:s="custom"}if(e.push(`<div class="section ${s}-section">`),t.value){const s=["section-title"];e.push(this.buildHtmlElement("div",t.value,s))}}return e}sectionEnd(t){return t instanceof b||t instanceof y?["</div>"]:[]}metadataStart(){return[`<div class=${["song-metadata"].join(" ")}>`]}metadataEnd(){return["</div>"]}contentStart(){return[`<div class=${["song-content"].join(" ")}>`]}contentEnd(){return["</div>"]}}class ${constructor(t){this._lines=[],this._builder=t}format(t){return this.settings.showMetadata&&this.formatMetadata(t),this._lines.push(...this._builder.contentStart()),t.sections.forEach((t=>{(this.settings.showTabs||t.sectionType!=r.Tabs)&&(this._lines.push(...this._builder.sectionStart(t)),t.lines.forEach((t=>{t instanceof c?this._lines.push(...this._builder.emptyLine()):t instanceof d?this._lines.push(...this._builder.lyricsLine(t)):t instanceof m?this._lines.push(...this._builder.tabLine(t)):t instanceof u&&this._lines.push(...this._builder.commentLine(t))})),this._lines.push(...this._builder.sectionEnd(t)))})),this._lines.push(...this._builder.contentEnd()),this._lines}formatMetadata(t){var e,s,a;this._lines.push(...this._builder.metadataStart()),(null===(e=t.title)||void 0===e?void 0:e.trim())&&this._lines.push(...this._builder.titleMetadata(t.title)),(null===(s=t.subtitle)||void 0===s?void 0:s.trim())&&this._lines.push(...this._builder.subtitleMetadata(t.subtitle)),t.artists.length>0&&this._lines.push(...this._builder.artistsMetadata(t.artists)),t.composers.length>0&&this._lines.push(...this._builder.composersMetadata(t.composers)),t.lyricists.length>0&&this._lines.push(...this._builder.lyricistsMetadata(t.lyricists)),t.arrangers.length>0&&this._lines.push(...this._builder.arrangersMetadata(t.arrangers)),(null===(a=t.copyright)||void 0===a?void 0:a.trim())&&this._lines.push(...this._builder.copyrightMetadata(t.copyright)),t.time&&this._lines.push(...this._builder.timeMetadata(`${t.time.topNumber}/${t.time.bottomNumber}`)),t.tempo&&t.tempo>0&&this._lines.push(...this._builder.tempoMetadata(t.tempo)),t.year&&this._lines.push(...this._builder.yearMetadata(t.year)),t.duration&&t.duration>0&&this._lines.push(...this._builder.durationMetadata(t.duration)),t.key&&this._lines.push(...this._builder.keyMetadata(t.key.toString())),t.capo&&t.capo>0&&this._lines.push(...this._builder.capoMetadata(t.capo)),t.customMetadatas.length>0&&this._lines.push(...this._builder.customMetadatas(t.customMetadatas)),this._lines.push(...this._builder.metadataEnd())}}class P extends x{constructor(){super(...arguments),this.showMetadata=!0,this.showTabs=!0}}class W extends ${constructor(t=new P){super(new G(t)),this.settings=t}}class U extends ${constructor(t=new P){super(new F(t)),this.settings=t}}class j extends ${constructor(t=new P){super(new H(t)),this.settings=t}}return l})()}));